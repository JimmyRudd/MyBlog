---
layout: default
title: 反编译和打包
---  
##工具篇  
###apktool  
1.apk反编译工具，相当于普通反编译工具的集成，可以将dex转化为smali文件，将二进制的AndroidManifest.xml逆向回可读格式，同时逆向资源文件resources.arsc。修改完后可以重新打包回apk  
2.不同jdk版本编译生成的apk，需要用到不同版本的apktool来反编译。（jdk1.7对应用apktool_2.0.0rc3)  
3.更换apktool.jar后仍无法反编译，抛出异常中包含framework\1.apk的，删除user目录下的apktool\framework\1.apk 
4.apktool反编译不稳定，不可过分依靠  
###baksmali  
DEX的逆向工具，可以将apk压缩包中的classes.dex文件反编译成smali文件，·注意apktool反编译和baksmali反编译生成的smali格式不同，不能互相替换。·

`想混合apktool使用，可以先用baksmali修改smali文件，之后生成dex文件替换回apk中，然后再用apktool反编译`  

###baksmali  
将smali文件重新生成dex文件  
  
###dex2jar  
DEX的逆向工具，可以将apk压缩包中的classes.dex文件转换成jar文件    

###jd-gui  
可以查看jar文件的反编译工具  

***
  
##命令篇

###一.aapt(Android Asset Packaging Tool)  

####功能介绍
1.列出压缩文件目录  

	aapt l[ist] [-v] [-a] file.{zip,jar,apk}  

2.查看apk详细信息  

	aapt dump badging <file_path.apk>//查看apk包的label and icon、packageName、versionCode、applicationLabel、launcherActivity、permission等各种详细信息  

	aapt dump permissions <file_path.apk>//查看权限  

	aapt dump resources <file_path.apk> > XXX.txt //查看资源列表,输出到指定文件  

	aapt dump configurations <file_path.apk>//查看apk配置信息  

	aapt dump xmltree <file_path.apk> res/***.xml//以树形结构输出的xml信息。  

	aapt dump xmlstrings <file_path.apk> res/***.xml//输出xml文件中所有的字符串信息。  

3.生成R.java文件和(`自动打包和二次打包修改资源`)  

生成R.java文件`配合apktool使用时,修改资源文件后,通过aapt命令重新生成对应的R.java文件(但要注意smali文件中已经存在的R.java的id对应地址数值)`  	
	aapt package -f -m -J %GEN% -S %RES% -I %ANDROID_JAR% -M %ANDROID_MANIFEST_XML%//生成R.java文件 

	%GEN%:存放的R.java文件夹路径。  
	%RES:res文件夹路径。  
	%ANDROID_JAR:引用的android.jar路径。  
	%ANDROID_MANIFEST_XML:工程AndroidManifest.xml绝对路径。  

将资源文件编译成二进制文件  

	aapt package -f -M %ANDROID_MANIFEST_XML% -S %RES% -A %ASSETS% -I %ANDROID_JAR% -F %RESOURCE%
		
	%ASSETS%:asset文件夹路径。
	%RESOURCE%:生成的resouces.arsc存放路径。  


####参考资料  
[aapt使用小结——via:Sodino](http://blog.csdn.net/sodino/article/details/6122665)  

[使用ANT打包Android应用——via:liuhe688](http://blog.csdn.net/liuhe688/article/details/6679879)  

  